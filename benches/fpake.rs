use criterion::{criterion_group, criterion_main, Criterion};
use ductile::new_local_channel;
use magic_pake::fpake::*;
use std::thread;

fn fpake(password: &'static [u8]) {
    let threshold = 0;

    let (s1, r1) = new_local_channel();
    let (s2, r2) = new_local_channel();
    let ch1 = (s2, r1);
    let ch2 = (s1, r2);
    let h1 = thread::spawn(move || {
        // Party 1
        let k1 = HalfKey::garbler(password, threshold, &ch1).unwrap();
        let k2 = HalfKey::evaluator(password, &ch1).unwrap();
        k1.combine(k2)
    });

    let h2 = thread::spawn(move || {
        // Party 2
        let k2 = HalfKey::evaluator(password, &ch2).unwrap();
        let k1 = HalfKey::garbler(password, threshold, &ch2).unwrap();
        k1.combine(k2)
    });

    let _k1 = h1.join().unwrap();
    let _k2 = h2.join().unwrap();
}

fn bench_fpake(c: &mut Criterion) {
    c.bench_function("fPAKE 64bit", |b| b.iter(|| fpake(b"password")));
    c.bench_function("fPAKE 128bit", |b| b.iter(|| fpake(b"passwordpassword")));
}

fn fpake_one_of_many_bit(password: &'static [u8]) {
    let passwords = [
        b"01234567".to_vec(),
        b"12345678".to_vec(),
        b"23456789".to_vec(),
        b"34567890".to_vec(),
        b"45678901".to_vec(),
        b"56789012".to_vec(),
        b"67890123".to_vec(),
        b"78901234".to_vec(),
    ];
    let passwords_2 = passwords.clone();
    let number_of_passwords = passwords.len() as u16;
    let index = 1;
    let password = passwords[index as usize].clone();
    let password_2 = password.clone();
    let threshold = 0;

    // Do the thing
    let (s1, r1) = new_local_channel();
    let (s2, r2) = new_local_channel();
    let ch1 = (s2, r1);
    let ch2 = (s1, r2);
    let h1 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::garbler_server(&passwords, threshold, &ch1).unwrap();
        let k2 = OneOfManyKey::garbler_client(
            &password,
            index,
            number_of_passwords,
            threshold,
            &ch1,
        ).unwrap();
        k1.combine(k2);
    });

    let h2 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::evaluator_client(&password_2, number_of_passwords, index, &ch2).unwrap();
        let k2 = OneOfManyKey::evaluator_server(&passwords_2, &ch2).unwrap();
        k1.combine(k2);
    });

    let _k1 = h1.join().unwrap();
    let _k2 = h2.join().unwrap();
}

fn fpake_one_of_many_128bit() {
    let passwords = [
        b"0123456701234567".to_vec(),
        b"1234567812345678".to_vec(),
        b"2345678923456789".to_vec(),
        b"3456789034567890".to_vec(),
        b"4567890145678901".to_vec(),
        b"5678901256789012".to_vec(),
        b"6789012367890123".to_vec(),
        b"7890123478901234".to_vec(),
    ];
    let passwords_2 = passwords.clone();
    let number_of_passwords = passwords.len() as u16;
    let index = 1;
    let password = passwords[index as usize].clone();
    let password_2 = password.clone();
    let threshold = 0;

    // Do the thing
    let (s1, r1) = new_local_channel();
    let (s2, r2) = new_local_channel();
    let ch1 = (s2, r1);
    let ch2 = (s1, r2);
    let h1 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::garbler_server(&passwords, threshold, &ch1).unwrap();
        let k2 = OneOfManyKey::garbler_client(
            &password,
            index,
            number_of_passwords,
            threshold,
            &ch1,
        ).unwrap();
        k1.combine(k2);
    });

    let h2 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::evaluator_client(&password_2, number_of_passwords, index, &ch2).unwrap();
        let k2 = OneOfManyKey::evaluator_server(&passwords_2, &ch2).unwrap();
        k1.combine(k2);
    });

    let _k1 = h1.join().unwrap();
    let _k2 = h2.join().unwrap();
}

fn fpake_one_of_many_2048bit() {
    let passwords = [
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
    ];
    let passwords_2 = passwords.clone();
    let number_of_passwords = passwords.len() as u16;
    let index = 1;
    let password = passwords[index as usize].clone();
    let password_2 = password.clone();
    let threshold = 0;

    // Do the thing
    let (s1, r1) = new_local_channel();
    let (s2, r2) = new_local_channel();
    let ch1 = (s2, r1);
    let ch2 = (s1, r2);
    let h1 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::garbler_server(&passwords, threshold, &ch1).unwrap();
        let k2 = OneOfManyKey::garbler_client(
            &password,
            index,
            number_of_passwords,
            threshold,
            &ch1
        ).unwrap();
        k1.combine(k2);
    });

    let h2 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::evaluator_client(&password_2, number_of_passwords, index, &ch2).unwrap();
        let k2 = OneOfManyKey::evaluator_server(&passwords_2, &ch2).unwrap();
        k1.combine(k2);
    });

    let _k1 = h1.join().unwrap();
    let _k2 = h2.join().unwrap();
}

fn fpake_one_of_many_2048bit_128passwords() {
    let passwords = [
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
        b"0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567".to_vec(),
        b"1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678".to_vec(),
        b"2345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789234567892345678923456789".to_vec(),
        b"3456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890345678903456789034567890".to_vec(),
        b"4567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901456789014567890145678901".to_vec(),
        b"5678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012567890125678901256789012".to_vec(),
        b"6789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123678901236789012367890123".to_vec(),
        b"7890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234789012347890123478901234".to_vec(),
    ];
    let passwords_2 = passwords.clone();
    let number_of_passwords = passwords.len() as u16;
    let index = 1;
    let password = passwords[index as usize].clone();
    let password_2 = password.clone();
    let threshold = 0;

    // Do the thing
    let (s1, r1) = new_local_channel();
    let (s2, r2) = new_local_channel();
    let ch1 = (s2, r1);
    let ch2 = (s1, r2);
    let h1 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::garbler_server(&passwords, threshold, &ch1).unwrap();
        let k2 = OneOfManyKey::garbler_client(
            &password,
            index,
            number_of_passwords,
            threshold,
            &ch1
        ).unwrap();
        k1.combine(k2);
    });

    let h2 = thread::spawn(move || {
        // Party 1
        let k1 = OneOfManyKey::evaluator_client(&password_2, number_of_passwords, index, &ch2).unwrap();
        let k2 = OneOfManyKey::evaluator_server(&passwords_2, &ch2).unwrap();
        k1.combine(k2);
    });

    let _k1 = h1.join().unwrap();
    let _k2 = h2.join().unwrap();
}

fn bench_fpake_one_of_many(c: &mut Criterion) {
    c.bench_function("fPAKE One of Many 128bit (8 passwords)", |b| {
        b.iter(fpake_one_of_many_128bit)
    });
    c.bench_function("fPAKE One of Many 2048bit (8 passwords)", |b| {
        b.iter(fpake_one_of_many_2048bit)
    });
    c.bench_function("fPAKE One of Many 2048bit (128 passwords)", |b| {
        b.iter(fpake_one_of_many_2048bit_128passwords)
    });
}

criterion_group!(benches, bench_fpake, bench_fpake_one_of_many);
criterion_main!(benches);
